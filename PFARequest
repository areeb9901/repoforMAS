CollateralDocStatusDetails collateralDocStatusDetails =
            getCollateralDocStatusDetails(collateralSegmentId, documentId);

    NegotiationDocument negotiationDocument =
            getNegotiationDoc(masterAgreement, collateralDocStatusDetails);

    // âœ… Strong guarantee: status details always have a segment id
    String segmentIdFromDoc = negotiationDocument != null ? negotiationDocument.getSegmentId() : null;
    if (collateralDocStatusDetails != null) {
        if (collateralDocStatusDetails.getCollateralSegmentId() == null
                || collateralDocStatusDetails.getCollateralSegmentId().trim().isEmpty()) {
            // Prefer the request param, otherwise fall back to doc
            String seg = (collateralSegmentId != null && !collateralSegmentId.trim().isEmpty())
                    ? collateralSegmentId
                    : segmentIdFromDoc;
            collateralDocStatusDetails.setCollateralSegmentId(seg);
        }
    }

    String negotiator = negotiationDocument.getNegotiator().getFullName();
    emailComments = negotiationDocument.getEmailNotificationsComments();

    // Audit log (will use segmentId from status details)
    collateralOpsService.createAuditLogForRedirectChase(
            negotiationDocument,
            getUser(),
            masterAgreement,
            collateralDocStatusDetails,
            "",
            "chase");

    // Persist chase info in status details
    collateralDocStatusDetails.setChasedUser(getUser().getFullname());
    collateralDocStatusDetails.setChasedDate(
            BeagleDateFormat.format(new java.util.Date(), BeagleDateFormat.FORMAT));

    repository.save(collateralDocStatusDetails);

    // Email
    super.sendRedirectMail(
            buildMailBody(negotiator, collateralSegmentId).toString(),
            negotiationDocument,
            collateralDocStatusDetails,
            "");

    // Reindex
    collateralOpsService.reindexMA(masterAgreement);
